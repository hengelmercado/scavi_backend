<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="google-signin-client_id" content="803339558848-k5rdsf9trgn399q808qbmielsjra0cej.apps.googleusercontent.com">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google signin</title>
    
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>

    <style>
        table { 
            overflow-x: auto;
            width: 100%;
        }
        th, tr, td {
            border: 1px solid black;
        }
        tr {
            width: 100%;
        }
    </style>

</head>
<body>

    <h1> REST server </h1>
    <hr>

    <button onclick="ajax('pais')"> Pais </button>
    <button onclick="ajax('departamento')"> Departamento </button>
    <button onclick="ajax('ciudad')"> Ciudad </button>
    <button onclick="ajax('tipoDocumento')"> Tipo Documento </button>
    <button onclick="ajax('tipoInstrumento')"> Tipo Instrumento </button>
    <button onclick="ajax('direccion')"> dirección </button>
    <button onclick="ajax('tercero')"> Terceros </button>
    <button onclick="ajax('instrumento')"> Instrumento </button>
    <button onclick="ajax('persona')"> Persona </button>
    <button onclick="ajax('medico')"> Médico </button>
    <button onclick="ajax('paciente')"> Paciente </button>


    <table id="tabla" style="display: none;">
        <thead id="thead">
        </thead>
        <tbody id="tbody">

        </tbody>
        
    </table>

    <script>

        var url = (window.location.hostname.includes('localhost'))
                    ? 'http://localhost:8081/api/'
                    : 'https://scavi-backend.herokuapp.com/api/';

        function ajax(coleccion = ''){
            var url = url + coleccion;
            $.ajax({
                type: "GET",
                dataType: 'json',
                url: url,
                success: function(response) {
                    if(response.total > 0){
                        var labels = Object.keys(response.datos[0]).reverse();
                        var thead = "<tr>";

                        labels.forEach(label => {
                            thead += "<th>" + label + "</th>";
                        });
                        
                        thead += "</tr>";
                        
                        var tbody = '';
                        for( i = 0; i < response.total; i++){
                            tbody += "<tr>";
                            labels.forEach(label => {
                                if(typeof response.datos[i][label] === "object"){
                                    var object = response.datos[i][label];
                                    tbody += "<td>" + object.nombre + "</td>";
                                }else{
                                    tbody += "<td>" + response.datos[i][label] + "</td>";
                                }
                            });
                            tbody += "</tr>";
                        }
                        $("#thead").html(thead);
                        $("#tbody").html(tbody);

                        $("#tabla").css("display", "block");
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    console.log(xhr.status);
                    console.log(thrownError);
                    console.log(ajaxOptions);
                }
            });
        }
        
    </script>

    <!-- <h1>Google Signin</h1>
    <hr>

    <div class="g-signin2" data-onsuccess="onSignIn"></div>
    <a href="#" onclick="signOut();">Sign out</a>


    <script src="https://apis.google.com/js/platform.js" async defer></script>
    
    <script>

        var url = (window.location.hostname.includes('localhost'))
            ? 'http://localhost:8081/api/auth/google'
            : 'https://webservice-curso-node.herokuapp.com/api/auth/google';

        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
            console.log('Name: ' + profile.getName());
            console.log('Image URL: ' + profile.getImageUrl());
            console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.

            var id_token = googleUser.getAuthResponse().id_token;
            const data = { id_token };

            fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then( resp => resp,json() )
            .then( data =>console.log("Nuestro server", data ) )
            .catch( error => console.log(error) );
        }

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
            console.log('User signed out.');
            });
        }
    </script> -->

</body>
</html>