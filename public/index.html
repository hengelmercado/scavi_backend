<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="google-signin-client_id" content="803339558848-k5rdsf9trgn399q808qbmielsjra0cej.apps.googleusercontent.com">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google signin</title>
    
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>

    <style>
        table {
            width: 100%;
        }
        table, th, td {
            border: 1px solid black;
        }
    </style>

</head>
<body>

    <h1> REST server </h1>
    <hr>

    <button id="btnPais"> Pais </button>
    <table id="pais" style="display: none;">
        <thead>
            <tr>
                <th>UID</th>
                <th>Nombre</th>
                <th>Descripcion</th>
                <th>Habilitado</th>
            </tr>
        </thead>
        <tbody id="tbodyPais">

        </tbody>
        
    </table>
    <button id="btnCiudad"> obtener </button>
    <table id="ciudad" style="display: none;">
        <thead>
            <tr>
                <th>UID</th>
                <th>Nombre</th>
                <th>Descripcion</th>
                <th>Habilitado</th>
            </tr>
        </thead>
        <tbody id="tbodyPais">

        </tbody>
        
    </table>

    <script>
        var activa_ahora = '';

        $("#btnPais").click(function () {    
            $("#pais").css("display", "block");
            $(""+activa_ahora).css("display", "none");
            activa_ahora = "#pais";
            ajax("pais");
            $.ajax({
                type: "GET",
                dataType: 'json',
                url: "http://localhost:8081/api/pais",
                success: function(response) {
                    console.log(response);
                    if(response.total > 0){
                        var tbosy = '';
                        for( i = 0; i < response.total; i++){
                            tbosy += "<tr>"+
                                "<td>" + response.datos[i].uid + "</td>" +
                                "<td>" + response.datos[i].nombre + "</td>" +
                                "<td>" + response.datos[i].descripcion + "</td>" +
                                "<td>" + response.datos[i].habilitado + "</td>" +
                                "</tr>";
                        }
                        $("#tbodyPais").html(tbosy);
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    console.log(xhr.status);
                    console.log(thrownError);
                    console.log(ajaxOptions);
                }
            });

        });

        function ajax(coleccion = ''){
            var url = "http://localhost:8081/api/" + coleccion;
            $.ajax({
                type: "GET",
                dataType: 'json',
                url: url,
                success: function(response) {
                    console.log(response);
                    if(response.total > 0){
                        var labels = Object.keys(response.datos[0]);
                        console.log(labels.reverse());
                        var tbosy = '';
                        for( i = 0; i < response.total; i++){
                            tbosy += "<tr>"+
                                "<td>" + response.datos[i].uid + "</td>" +
                                "<td>" + response.datos[i].nombre + "</td>" +
                                "<td>" + response.datos[i].descripcion + "</td>" +
                                "<td>" + response.datos[i].habilitado + "</td>" +
                                "</tr>";
                        }
                       return tbosy;
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    console.log(xhr.status);
                    console.log(thrownError);
                    console.log(ajaxOptions);
                }
            });
        }
        
    </script>

    <!-- <h1>Google Signin</h1>
    <hr>

    <div class="g-signin2" data-onsuccess="onSignIn"></div>
    <a href="#" onclick="signOut();">Sign out</a>


    <script src="https://apis.google.com/js/platform.js" async defer></script>
    
    <script>

        var url = (window.location.hostname.includes('localhost'))
            ? 'http://localhost:8081/api/auth/google'
            : 'https://webservice-curso-node.herokuapp.com/api/auth/google';

        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
            console.log('Name: ' + profile.getName());
            console.log('Image URL: ' + profile.getImageUrl());
            console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.

            var id_token = googleUser.getAuthResponse().id_token;
            const data = { id_token };

            fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then( resp => resp,json() )
            .then( data =>console.log("Nuestro server", data ) )
            .catch( error => console.log(error) );
        }

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
            console.log('User signed out.');
            });
        }
    </script> -->

</body>
</html>